<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ù†ÙˆÙ†Ùˆ Ù…Ø³Ø§Ø¹Ø¯ Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ù†ÙˆØ± Ù„Ù„Ø¬Ù…Ø¨Ø§Ø²</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
</head>
<body class="bg-gray-100">
    <div id="root"></div>

    <script>
        const { useState, useEffect, useRef } = React;
        
        const App = () => {
            const [messages, setMessages] = useState([
                { id: 1, text: 'Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ! Ø£Ù†Ø§ Ù†ÙˆÙ†ÙˆØŒ Ù…Ø³Ø§Ø¹Ø¯Ùƒ ÙÙŠ Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ù†ÙˆØ± Ù„Ù„Ø¬Ù…Ø¨Ø§Ø². ÙƒÙ…Ø¯Ø±Ø¨ Ø¬Ù…Ø¨Ø§Ø² ÙÙ†ÙŠ Ø³Ø§Ø¨Ù‚ØŒ Ù‡Ø³ØªÙ…Ø¹ Ù„Ø£Ø³Ø¦Ù„ØªÙƒ ÙˆØ£Ø³Ø§Ø¹Ø¯Ùƒ Ø¨Ø£ÙØ¶Ù„ Ù…Ø§ Ø¹Ù†Ø¯ÙŠ! ğŸ†', type: 'bot' }
            ]);
            const [input, setInput] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [knowledgeData, setKnowledgeData] = useState('');
            
            // ğŸ”‘ Ø¶Ø¹ API Key Ù‡Ù†Ø§
            const GEMINI_API_KEY = "AIzaSyCENKrIphUGX_bA7XgcqqInVc_ZhkA3TY";

            // ØªØ­Ù…ÙŠÙ„ knowledge.txt Ø¹Ù†Ø¯ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
            useEffect(() => {
                fetch('./knowledge.txt')
                    .then(response => response.text())
                    .then(data => {
                        setKnowledgeData(data);
                        console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ knowledge.txt');
                    })
                    .catch(error => {
                        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ knowledge.txt:', error);
                    });
            }, []);

            const findAnswerInKnowledge = (question, knowledgeText) => {
                if (!knowledgeText) return "Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…Ø¹Ø±ÙØ© ØºÙŠØ± Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.";
                
                const lines = knowledgeText.split('\n').filter(line => line.trim() !== '');
                const cleanQuestion = question.toLowerCase().replace(/\?|\.|ØŒ|,/g, '').trim();

                for (let i = 0; i < lines.length; i++) {
                    if (lines[i].startsWith('Ø³Ø¤Ø§Ù„:')) {
                        const questionLine = lines[i].replace('Ø³Ø¤Ø§Ù„:', '').trim().toLowerCase();
                        const answerLine = lines[i + 1] ? lines[i + 1].replace('Ø¬ÙˆØ§Ø¨:', '').trim() : '';
                        
                        if (!answerLine) continue;

                        if (cleanQuestion.includes(questionLine) || questionLine.includes(cleanQuestion)) {
                            return answerLine;
                        }
                    }
                }
                return "Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ù… Ø£Ø¬Ø¯ Ø¥Ø¬Ø§Ø¨Ø© Ø¯Ù‚ÙŠÙ‚Ø© Ù„Ø³Ø¤Ø§Ù„Ùƒ. Ù…Ù…ÙƒÙ† ØªØ¹ÙŠØ¯ ØµÙŠØ§ØºØ© Ø§Ù„Ø³Ø¤Ø§Ù„ØŸ";
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!input.trim()) return;
                
                setMessages(prev => [...prev, { id: Date.now(), text: input, type: 'user' }]);
                const currentInput = input;
                setInput('');
                setIsLoading(true);

                try {
                    // Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨Øª Ø§Ù„Ù…Ø­Ø³Ù‘Ù† - Ù…Ø¯Ø±Ø¨ Ø¬Ù…Ø¨Ø§Ø² Ù…Ø­ØªØ±Ù
                    const prompt = `You are "Nono", an AI assistant created to answer gymnastics-related questions for "Noor Gymnastics Academy".

STYLE & TONE:
- Speak in Arabic Egyptian dialect.
- Sound like a former artistic gymnast with strong experience and a current professional artistic gymnastics coach.
- Be friendly, supportive, encouraging, and knowledgeable.
- Provide clear, safe, practical advice for parents, kids, and new athletes.
- Never give medical diagnoses. If asked, advise to check a medical professional.
- Never answer outside gymnastics, sports education, child development, or academy-related topics.

ROLE:
Your job is to answer the client's question clearly and professionally as a gymnastics expert.

ACADEMY CONTEXT:
- Noor Academy is a specialized academy offering artistic gymnastics training for children.
- Focus on discipline, safety, talent development, fun, and building confidence.
- We help kids discover their abilities and progress step-by-step.

KNOWLEDGE BASE INFORMATION:
${knowledgeData}

YOUR TASK:
Answer the following client question in the best helpful way as a professional gymnastics coach:

QUESTION: ${currentInput}

Remember: Answer in Egyptian Arabic, be supportive and professional.`;

                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${GEMINI_API_KEY}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: prompt
                                }]
                            }]
                        })
                    });

                    const data = await response.json();
                    
                    if (data.candidates && data.candidates[0]) {
                        const botResponse = data.candidates[0].content.parts[0].text;
                        setMessages(prev => [...prev, { id: Date.now() + 1, text: botResponse, type: 'bot' }]);
                    } else {
                        throw new Error('No response from Gemini');
                    }
                    
                } catch (error) {
                    console.log('ğŸ”„ Ø§Ø³ØªØ®Ø¯Ø§Ù… knowledge.txt ÙƒØ¨Ø¯ÙŠÙ„ Ù…Ø¨Ø§Ø´Ø±');
                    // Ø¥Ø°Ø§ ÙØ´Ù„ GeminiØŒ Ø¥Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø± ÙÙŠ Ø§Ù„Ù…Ù„Ù
                    const directAnswer = findAnswerInKnowledge(currentInput, knowledgeData);
                    setMessages(prev => [...prev, { id: Date.now() + 1, text: directAnswer, type: 'bot' }]);
                } finally {
                    setIsLoading(false);
                }
            };

            return React.createElement('div', { className: 'h-screen flex flex-col' },
                [
                    React.createElement('header', { 
                        key: 'header',
                        className: 'bg-gradient-to-r from-purple-600 to-indigo-700 text-white p-4 text-center shadow-lg'
                    }, 
                        React.createElement('div', { className: 'flex items-center justify-center gap-3' },
                            [
                                React.createElement('div', { 
                                    key: 'icon',
                                    className: 'w-10 h-10 bg-white rounded-full flex items-center justify-center text-purple-600 font-bold text-lg'
                                }, 'Ù†'),
                                React.createElement('div', { key: 'text' },
                                    [
                                        React.createElement('h1', { 
                                            key: 'title',
                                            className: 'text-2xl font-bold'
                                        }, 'Ù†ÙˆÙ†Ùˆ - Ù…Ø³Ø§Ø¹Ø¯ Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ù†ÙˆØ± Ù„Ù„Ø¬Ù…Ø¨Ø§Ø²'),
                                        React.createElement('p', {
                                            key: 'subtitle', 
                                            className: 'text-sm opacity-90'
                                        }, 'Ù…Ø¯Ø±Ø¨ Ø¬Ù…Ø¨Ø§Ø² ÙÙ†ÙŠ Ù…Ø­ØªØ±Ù')
                                    ]
                                )
                            ]
                        )
                    ),
                    
                    React.createElement('main', {
                        key: 'main',
                        className: 'flex-1 p-4 overflow-y-auto bg-gradient-to-b from-gray-50 to-white'
                    }, 
                        messages.map(msg => 
                            React.createElement('div', {
                                key: msg.id,
                                className: `p-4 my-3 rounded-2xl max-w-md transition-all duration-300 ${
                                    msg.type === 'user' 
                                        ? 'bg-gradient-to-l from-blue-500 to-blue-600 text-white ml-auto shadow-lg' 
                                        : 'bg-white text-gray-800 mr-auto border-2 border-purple-100 shadow-md hover:shadow-lg'
                                }`
                            }, msg.text)
                        ).concat(
                            isLoading ? React.createElement('div', {
                                key: 'loading',
                                className: 'p-4 my-3 bg-gradient-to-r from-purple-100 to-indigo-100 rounded-2xl mr-auto max-w-md text-center text-purple-700 border border-purple-200'
                            }, 
                                React.createElement('div', { className: 'flex items-center justify-center gap-2' },
                                    [
                                        React.createElement('div', { 
                                            key: 'loader',
                                            className: 'w-6 h-6 border-2 border-purple-600 border-t-transparent rounded-full animate-spin'
                                        }),
                                        'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£ÙØ¶Ù„ Ø¥Ø¬Ø§Ø¨Ø©...'
                                    ]
                                )
                            ) : null
                        )
                    ),
                    
                    React.createElement('footer', {
                        key: 'footer', 
                        className: 'p-4 bg-white border-t border-gray-200 shadow-inner'
                    }, 
                        React.createElement('form', { onSubmit: handleSubmit, className: 'flex gap-3' },
                            [
                                React.createElement('input', {
                                    key: 'input',
                                    type: 'text',
                                    value: input,
                                    onChange: (e) => setInput(e.target.value),
                                    placeholder: 'Ø§Ø³Ø£Ù„ Ø¹Ù† Ø§Ù„Ø¬Ù…Ø¨Ø§Ø²ØŒ Ø§Ù„ØªØ¯Ø±ÙŠØ¨Ø§ØªØŒ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±ØŒ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯...',
                                    className: 'flex-1 p-4 border-2 border-gray-300 rounded-full focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all'
                                }),
                                React.createElement('button', {
                                    key: 'button',
                                    type: 'submit',
                                    disabled: isLoading || !input.trim(),
                                    className: `px-8 py-4 rounded-full font-bold transition-all duration-300 ${
                                        isLoading || !input.trim()
                                            ? 'bg-gray-400 text-gray-200 cursor-not-allowed' 
                                            : 'bg-gradient-to-r from-purple-600 to-indigo-600 text-white hover:from-purple-700 hover:to-indigo-700 hover:scale-105 shadow-lg hover:shadow-xl'
                                    }`
                                }, isLoading ? 'â³' : 'ğŸš€ Ø¥Ø±Ø³Ø§Ù„')
                            ]
                        )
                    )
                ]
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
    </script>
</body>
</html>
