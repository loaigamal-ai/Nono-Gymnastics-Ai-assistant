<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>نونو مساعد اكاديمية نور للجمباز</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
</head>
<body class="bg-gray-100">
    <div id="root"></div>

    <script>
        const { useState, useEffect, useRef } = React;
        
        const App = () => {
            const [messages, setMessages] = useState([
                { id: 1, text: 'أهلاً بك! أنا نونو مساعد أكاديمية نور للجمباز. نقدر نبقى صحاب و ندردش بخصوص الجمباز بشكل عام او عن اكاديمية نور للجمباز بشكل خاص.', type: 'bot' }
            ]);
            const [input, setInput] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            
            const findAnswerInKnowledge = (question, knowledgeText) => {
                question = question.toLowerCase();
                const lines = knowledgeText.split('\n');
                
                for (let i = 0; i < lines.length; i += 2) {
                    const knowledgeQuestion = lines[i].toLowerCase();
                    const knowledgeAnswer = lines[i + 1];
                    
                    if (question.includes(knowledgeQuestion) || knowledgeQuestion.includes(question)) {
                        return knowledgeAnswer || "عذراً، لم أجد إجابة محددة.";
                    }
                }
                
                return "عذراً، لم أجد إجابة في قاعدة المعرفة.";
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                if (!input.trim()) return;
                
                setMessages(prev => [...prev, { id: Date.now(), text: input, type: 'user' }]);
                const currentInput = input;
                setInput('');
                setIsLoading(true);

                fetch('./knowledge.txt')
                    .then(response => response.text())
                    .then(knowledgeText => {
                        const answer = findAnswerInKnowledge(currentInput, knowledgeText);
                        setMessages(prev => [...prev, { id: Date.now() + 1, text: answer, type: 'bot' }]);
                    })
                    .catch(error => {
                        setMessages(prev => [...prev, { id: Date.now() + 1, text: 'عذراً، حدث خطأ في البحث.', type: 'bot' }]);
                    })
                    .finally(() => {
                        setIsLoading(false);
                    });
            };

            return React.createElement('div', { className: 'h-screen flex flex-col' },
                [
                    React.createElement('header', { 
                        key: 'header',
                        className: 'bg-purple-600 text-white p-4 text-center'
                    }, 'نونو - مساعد أكاديمية نور للجمباز'),
                    
                    React.createElement('main', {
                        key: 'main',
                        className: 'flex-1 p-4 overflow-y-auto'
                    }, 
                        messages.map(msg => 
                            React.createElement('div', {
                                key: msg.id,
                                className: `p-3 my-2 rounded-lg max-w-md ${
                                    msg.type === 'user' 
                                        ? 'bg-blue-500 text-white ml-auto' 
                                        : 'bg-gray-200 text-gray-800 mr-auto'
                                }`
                            }, msg.text)
                        ).concat(
                            isLoading ? React.createElement('div', {
                                key: 'loading',
                                className: 'p-3 my-2 bg-gray-300 rounded-lg mr-auto max-w-md'
                            }, 'جاري البحث...') : null
                        )
                    ),
                    
                    React.createElement('footer', {
                        key: 'footer', 
                        className: 'p-4 border-t bg-white'
                    }, 
                        React.createElement('form', { onSubmit: handleSubmit, className: 'flex gap-2' },
                            [
                                React.createElement('input', {
                                    key: 'input',
                                    type: 'text',
                                    value: input,
                                    onChange: (e) => setInput(e.target.value),
                                    placeholder: 'اكتب سؤالك هنا...',
                                    className: 'flex-1 p-3 border border-gray-300 rounded-full'
                                }),
                                React.createElement('button', {
                                    key: 'button',
                                    type: 'submit',
                                    disabled: isLoading,
                                    className: 'bg-purple-600 text-white px-6 py-3 rounded-full'
                                }, 'إرسال')
                            ]
                        )
                    )
                ]
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
    </script>
</body>
</html>
